<div class="admin-magasin-container" style="margin-top: 80px;">
  <h2>Gestion des Prestataires</h2>

  <div class="tab-controls">
    <button (click)="activeTab = 'pending'" [class.active]="activeTab === 'pending'">
      En attente ({{pendingPrestataires.length}})
    </button>
    <button (click)="activeTab = 'approved'" [class.active]="activeTab === 'approved'">
      Approuvés ({{approvedPrestataires.length}})
    </button>
    <button (click)="activeTab = 'rejected'" [class.active]="activeTab === 'rejected'">
      Rejetés ({{rejectedPrestataires.length}})
    </button>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="activeTab === 'pending'">
    <h3>Prestataires en attente d'approbation</h3>
    <div *ngIf="pendingPrestataires.length > 0; else noPendingPrestataires" class="magasin-list">
      <div *ngFor="let prestataire of pendingPrestataires" class="magasin-card">
        <h4>{{ prestataire.utilisateur?.fname }} {{ prestataire.utilisateur?.lname }}</h4>
        <p>Spécialité: {{ prestataire.specialite }}</p>
        <p>Ville: {{ prestataire.ville }}</p>
        <p>Téléphone: {{ prestataire.telephone }}</p>
        <p>Email: {{ prestataire.utilisateur?.email }}</p>
        <div class="card-actions">
          <button class="approve-btn" (click)="approvePrestataire(prestataire.idPrestataire)">Approuver</button>
          <button class="reject-btn" (click)="rejectPrestataire(prestataire.idPrestataire)">Rejeter</button>
          <button class="contact-btn" (click)="contactPrestataire(prestataire.utilisateur?.id)" [disabled]="isLoadingConnection">
            {{ isLoadingConnection ? 'Chargement...' : 'Contacter le prestataire' }}
          </button>
          <button class="contact-btn" [routerLink]="['/admin/prestataire-details', prestataire.idPrestataire]"> Voir les détails publics
          </button>
        </div>
      </div>
    </div>
    <ng-template #noPendingPrestataires>
      <p class="info-message">Aucun prestataire en attente d'approbation.</p>
    </ng-template>
  </div>

  <div *ngIf="activeTab === 'approved'">
    <h3>Prestataires approuvés</h3>
    <div *ngIf="approvedPrestataires.length > 0; else noApprovedPrestataires" class="magasin-list">
      <div *ngFor="let prestataire of approvedPrestataires" class="magasin-card">
        <h4>{{ prestataire.utilisateur?.fname }} {{ prestataire.utilisateur?.lname }}</h4>
        <p>Spécialité: {{ prestataire.specialite }}</p>
        <p>Ville: {{ prestataire.ville }}</p>
        <p>Téléphone: {{ prestataire.telephone }}</p>
        <p>Email: {{ prestataire.utilisateur?.email }}</p>
        <p class="status approved">Statut: Approuvé</p>
        <div class="card-actions">
          <button class="reject-btn" (click)="rejectPrestataire(prestataire.idPrestataire)">Rejeter</button>
          <button class="delete-btn" (click)="deletePrestataire(prestataire.idPrestataire)">Supprimer</button>
          <button class="contact-btn" (click)="contactPrestataire(prestataire.utilisateur?.id)" [disabled]="isLoadingConnection">
            {{ isLoadingConnection ? 'Chargement...' : 'Contacter le prestataire' }}
          </button>
          <button class="contact-btn" [routerLink]="['/admin/prestataire-details', prestataire.idPrestataire]"> Voir les détails publics
          </button>
          
        </div>
      </div>
    </div>
    <ng-template #noApprovedPrestataires>
      <p class="info-message">Aucun prestataire approuvé.</p>
    </ng-template>
  </div>

  <div *ngIf="activeTab === 'rejected'">
    <h3>Prestataires rejetés</h3>
    <div *ngIf="rejectedPrestataires.length > 0; else noRejectedPrestataires" class="magasin-list">
      <div *ngFor="let prestataire of rejectedPrestataires" class="magasin-card">
        <h4>{{ prestataire.utilisateur?.fname }} {{ prestataire.utilisateur?.lname }}</h4>
        <p>Spécialité: {{ prestataire.specialite }}</p>
        <p>Ville: {{ prestataire.ville }}</p>
        <p>Téléphone: {{ prestataire.telephone }}</p>
        <p>Email: {{ prestataire.utilisateur?.email }}</p>
        <p class="status rejected">Statut: Rejeté</p>
        <div class="card-actions">
          <button class="approve-btn" (click)="approvePrestataire(prestataire.idPrestataire)">Approuver</button>
          <button class="delete-btn" (click)="deletePrestataire(prestataire.idPrestataire)">Supprimer</button>
          <button class="contact-btn" (click)="contactPrestataire(prestataire.utilisateur?.id)" [disabled]="isLoadingConnection">
            {{ isLoadingConnection ? 'Chargement...' : 'Contacter le prestataire' }}
          </button>
          <button class="contact-btn" [routerLink]="['/admin/prestataire-details', prestataire.idPrestataire]"> Voir les détails publics
          </button>
          
        </div>
      </div>
    </div>
    <ng-template #noRejectedPrestataires>
      <p class="info-message">Aucun prestataire rejeté.</p>
    </ng-template>
  </div>
</div>